!function(i){i.entwine("ss",function(i){i(".ss-gridfield").entwine({showNoItemsMessage:function(){0===this.find(".ss-gridfield-items:first").children().not(".ss-gridfield-no-items").length&&this.find(".ss-gridfield-no-items").show()}}),i(".gridfield-help-button-dialog").entwine({loadDialog:function(i){var e=this.addClass("loading").children(".ui-dialog-content").empty();i.done(function(i){e.html(i).parent().removeClass("loading")})}}),i(".ss-gridfield .gridfield-help-button").entwine({onclick:function(){var e=i("<div></div>").appendTo("body").dialog({modal:!1,resizable:!0,width:600,height:600,close:function(){i(this).dialog("destroy").remove()}});return e.parent().addClass("gridfield-help-button-dialog").loadDialog(i.get(this.prop("href"))),e.data("grid",this.closest(".ss-gridfield")),!1}}),i(".ss-gridfield-hasOneSelector-reset_button[data-relation]").entwine({onclick:function(){return this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){i(this).find("input").prop("checked",!1)}),!1}}),i(".ss-gridfield-hasOneSelector-toggle[data-relation]").entwine({onclick:function(){var e=this.prop("checked");this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){i(this).find("input").prop("checked",!e)})}}),i(".ss-gridfield.ss-gridfield-add-inline-extended--table").entwine({reload:function(i,e){var d=this,t=d.find("tbody:first").find(".ss-gridfield-inline-new-extended--row").detach(),s=arguments;this._super(i,function(){t.length&&(t.appendTo(d.find("tbody:first")),d.find("tbody:first").children(".ss-gridfield-no-items:first").hide()),e&&e.apply(d,s)})},onaddnewinlinextended:function(e,d){if(e.target==this[0]){var t=this.find("tbody:first"),s=this.data("add-inline-num")||1;if(d&&d.data("ajax")){var n=d.hasClass("ss-ui-action-constructive"),a=d.siblings(".ss-gridfield-inline-new-extended--class-selector:first"),l={_datanum:s};if(a.length){if(!a.val())return void alert("Please select a type to create");l[this.attr("id")+"_modelClass"]=a.val()}d.addClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").addClass("ss-ui-loading-icon"),n&&d.removeClass("ss-ui-action-constructive"),i.ajax({url:d[0].href,dataType:"html",data:l,success:function(e){d.removeClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").removeClass("ss-ui-loading-icon");var s=i(e);s.find("ss-gridfield-editable-row--toggle"),t.append(s),t.children(".ss-gridfield-no-items:first").hide(),s.find("input:first").focus(),n&&d.addClass("ss-ui-action-constructive")},error:function(i){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),d.removeClass("ss-gridfield-add-inline-extended--loading disabled")}})}else{var r=window.tmpl,o=this.find(".ss-gridfield-add-inline-extended--template:last");r.cache[this[0].id+"-ss-gridfield-add-inline-extended--template"]=r(o.html());var g=i(r(this[0].id+"-ss-gridfield-add-inline-extended--template",{num:s}));t.append(g),t.children(".ss-gridfield-no-items:first").hide(),g.find("input:first").focus()}this.data("add-inline-num",s+1)}}}),i(".ss-gridfield-add-new-inline-extended--button").entwine({onclick:function(){return this.getGridField().trigger("addnewinlinextended",[this]),!1}}),i(".ss-gridfield-inline-new-extended--row-delete").entwine({onclick:function(){var i=this.parents(".ss-gridfield:first");return confirm(ss.i18n._t("GridFieldExtensions.CONFIRMDEL","Are you sure you want to delete this?"))&&(this.parents("tbody:first").find("tr[data-inline-new-extended-row="+this.parents("tr[data-inline-new-extended-row]:first").data("inlineNewExtendedRow")+"]").remove(),i.showNoItemsMessage()),!1}}),i(".ss-gridfield-add-inline-extended--toggle").entwine({onclick:function(){var i=this.parents("tr:first");return this.toggleClass("ss-gridfield-add-inline-extended--toggle_open"),i.parent().find(".ss-gridfield-inline-new-extended--row--has-columns[data-inline-new-extended-row="+i.data("inlineNewExtendedRow")+"]").toggleClass("ss-gridfield-inline-new-extended--row--has-columns_open"),!1}}),i(".cms-container").entwine({OpenGridFieldToggles:{},saveTabState:function(){var e=this,d=e.getOpenGridFieldToggles();e._super(),e.find(".ss-gridfield.ss-gridfield-editable-rows").each(function(){var e=i(this),t=e.getOpenToggles();t.length&&(d[e.attr("id")]=e.getOpenToggles())})},restoreTabState:function(e){var d=this,t=d.getOpenGridFieldToggles();d._super(e),i.each(t,function(i,e){d.find("#"+i+".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(e)}),d.setOpenGridFieldToggles({})}}),i(".ss-gridfield.ss-gridfield-editable-rows").entwine({reload:function(i,e){var d=this,t=d.getOpenToggles(),s=arguments;this._super(i,function(){d.reopenToggles(t),e&&e.apply(d,s)})},getOpenToggles:function(){var e=this,d=[];return e.hasClass("ss-gridfield-editable-rows_disableToggleState")?d:(e.find(".ss-gridfield-editable-row--toggle_open").each(function(e){var t=i(this),s=t.parents("td:first"),n=t.parents("tr:first"),a=n.parents(".ss-gridfield:first"),l=n.next();if(l.hasClass("ss-gridfield-editable-row--row")&&l.data("id")==n.data("id")&&l.data("class")==n.data("class")){if(a.hasClass("ss-gridfield-editable-rows_disableToggleState"))return!0}else l=null;d[e]={link:s.data("link")},l&&(l.find(".ss-tabset.ui-tabs").each(function(){d[e].tabs||(d[e].tabs={}),d[e].tabs[this.id]=i(this).tabs("option","selected")}),a.hasClass("ss-gridfield-editable-rows_allowCachedToggles")&&(d[e].row=l.detach()))}),d)},reopenToggles:function(e){var d=this,t=function(e,d){e.hasOwnProperty("tabs")&&e.tabs&&i.each(e.tabs,function(i,e){d.find("#"+i+".ss-tabset.ui-tabs").tabs({active:e})})};d.hasClass("ss-gridfield-editable-rows_disableToggleState")||i.each(e,function(i){if(!e[i].hasOwnProperty("link")||!e[i].link)return!0;var s=d.find("td.ss-gridfield-editable-row--icon-holder[data-link='"+e[i].link+"']");if(!s.length)return!0;if(e[i].hasOwnProperty("row")&&e[i].row){var n=s.parents("tr:first");s.find(".ss-gridfield-editable-row--toggle").addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),n.next().hasClass("ss-gridfield-editable-row--row")||n.after(e[i].row)}else e[i].hasOwnProperty("link")&&e[i].link&&s.find(".ss-gridfield-editable-row--toggle").trigger("click",function(s){d.find(".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(e),t(e[i],s)},!1)})}}),i(".ss-gridfield-editable-row--toggle").entwine({onclick:function(e,d,t){var s=this,n=s.parents("td:first"),a=n.data("link"),l=s.parents("tr:first");if(l.hasClass("ss-gridfield-editable-row--loading"))return!1;if(a&&!s.hasClass("ss-gridfield-editable-row--toggle_loaded"))l.addClass("ss-gridfield-editable-row--loading"),i.ajax({url:a,dataType:"html",success:function(e){var n=i(e);s.addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),l.removeClass("ss-gridfield-editable-row--loading"),l.after(n),t!==!1&&n.find("input:first").focus(),"function"==typeof d&&d(n,s,l)},error:function(i){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),l.removeClass("ss-gridfield-editable-row--loading")}});else if(a){var r=l.next();r.hasClass("ss-gridfield-editable-row--row")&&r.data("id")==l.data("id")&&r.data("class")==l.data("class")&&(s.toggleClass("ss-gridfield-editable-row--toggle_open"),s.hasClass("ss-gridfield-editable-row--toggle_open")?r.removeClass("ss-gridfield-editable-row--row_hide").find("input:first").focus():r.addClass("ss-gridfield-editable-row--row_hide"))}return!1}});var e;i(".ss-gridfield-range-slider--field.rangeslider.has-rangeslider").entwine({onchange:function(i){if(i.timeStamp!=e){e=i.timeStamp;var d=this.parents(".ss-gridfield-range-slider:first"),t=d.find(".ss-gridfield-range-slider--button");t.length&&t.click()}}}),i(".add-existing-picker-actions--add-items").entwine({onclick:function(i,e){var d=this.getDialog();this.addCloseDialogIfRequired(d),this.addItems(null,null,"",function(){e&&e(),d.data("grid").reload(),d.dialog("close")}),i.preventDefault()},getDialog:function(){return this.closest(".add-existing-search-dialog").children(".ui-dialog-content:first")},addItems:function(e,d,t,s,n){var a=this;e||(e=a.getDialog()),d||(d=e.data("items-to-add")||[]),d.length||(statusMessage(ss.i18n._t("GridField_AddExistingPicker.NO_ITEMS","No items selected"),"error"),e.find(".add-existing-search-items").children().length||e.dialog("close")),t||(t=e.find(".add-existing-picker-items").data("add-link")),s||(s=function(){e.data("grid")&&e.data("grid").reload()}),a.clearItemsToAdd(e),n||e.parent().addClass("loading loading_hiddenContents"),i.post(t,{ids:d},s).always(function(){e.parent().removeClass("loading loading_hiddenContents")})},undoItems:function(e,d,t,s,n){var a=this;d||(d=a.getDialog()),e.length&&(t||(t=d.find(".add-existing-picker-items").data("undo-link")),s||(s=function(){d.data("grid")&&d.data("grid").reload()}),n||d.parent().addClass("loading loading_hiddenContents"),i.post(t,{ids:e},function(){var i=[].slice.call(arguments);i.push(d),s.apply(this,i)}).always(function(){d.parent().removeClass("loading loading_hiddenContents")}))},clearItemsToAdd:function(i){i||(i=this.getDialog()),i.data("items-to-add",[])},addCloseDialogIfRequired:function(e){if(e||(e=this.getDialog()),!e.data("onClose")){var d=this;e.on("dialogbeforeclose",function(e,t){var s=i(this),n=s.data("items-to-add")||[];n.length&&confirm(ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.CONFIRM","Would you like to add %s selected items to the current list?"),n.length))?d.addItems(s,n,"",function(){s.data("grid").reload()}):d.clearItemsToAdd(s)}),e.data("onClose",!0)}}}),i(".add-existing-picker-item--undo-holder .add-existing-picker-item--undo").entwine({onclick:function(e){var d=this.data("id"),t=this.data("undoLink"),s=this.data("title"),n=i('.add-existing-picker-items[data-undo-link="'+t+'"]').find('.add-existing-picker-item--link[data-id="'+d+'"]');n.undoItem(d,!0,function(e,d,t,a){a.data("grid").reload(),i.noticeRemove(i(".notice-item.add-existing-picker-item--undo-holder")),statusMessage(ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.ITEM_REMOVED","%s has been removed."),s)),n.parent("li:first").show()}),e.preventDefault()}}),i(".add-existing-search-dialog .add-existing-search-items.add-existing-picker-items a").entwine({onclick:function(e){var d=this.getButton(),t=d.getDialog(),s=t.data("grid"),n=this.parent(),a=t.data("items-to-add")||[],l=this.data("id");if(s&&s.hasClass("ss-gridfield-add-existing-picker_async")){var r=t.find(".add-existing-picker-items").data("undo-link"),o=this.text();n.addClass("loading add-existing-picker-item_toAdd"),d.addItems(t,[l],"",function(){t.data("grid")&&t.data("grid").reload(),n.removeClass("add-existing-picker-item_toAdd loading").hide(),i.noticeAdd({text:ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.ITEM_ADDED","%s has been added. %s"),o,ss.i18n.sprintf('<button type="button" class="add-existing-picker-item--undo" data-id="%s" data-undo-link="%s" data-title="%s">%s</button>',l,r,o,ss.i18n._t("UNDO","Undo"))),type:"add-existing-picker-item--undo-holder",stay:!0})},!0)}else d.addCloseDialogIfRequired(t),-1===a.indexOf(l)?(a.push(l),n.addClass("add-existing-picker-item_toAdd")):(a.splice(a.indexOf(l),1),n.removeClass("add-existing-picker-item_toAdd")),t.data("items-to-add",a);e.preventDefault()},getButton:function(){return this.closest(".add-existing-search-dialog").find(".add-existing-picker-actions--add-items:first")},undoItem:function(i,e,d){i||(i=this.data("id"));var t=this.getButton();t.undoItems([i],null,"",d,e)}})})}(jQuery);