!function(e){e.entwine("ss",function(e){e(".cms-container").entwine({OpenGridFieldToggles:{},saveTabState:function(){var i=this,s=i.getOpenGridFieldToggles();i._super(),i.find(".ss-gridfield.ss-gridfield-editable-rows").each(function(){var i=e(this),d=i.getOpenToggles();d.length&&(s[i.attr("id")]=i.getOpenToggles())})},restoreTabState:function(i){var s=this,d=s.getOpenGridFieldToggles();s._super(i),e.each(d,function(e,i){s.find("#"+e+".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(i)}),s.setOpenGridFieldToggles({})}}),e(".ss-gridfield").entwine({showNoItemsMessage:function(){0===this.find(".ss-gridfield-items:first").children().not(".ss-gridfield-no-items").length&&this.find(".ss-gridfield-no-items").show()}}),e(".gridfield-help-button-dialog").entwine({loadDialog:function(e){var i=this.addClass("loading").children(".ui-dialog-content").empty();e.done(function(e){i.html(e).parent().removeClass("loading")})}}),e(".ss-gridfield .gridfield-help-button").entwine({onclick:function(){var i=e("<div></div>").appendTo("body").dialog({modal:!1,resizable:!0,width:600,height:600,close:function(){e(this).dialog("destroy").remove()}});return i.parent().addClass("gridfield-help-button-dialog").loadDialog(e.get(this.prop("href"))),i.data("grid",this.closest(".ss-gridfield")),!1}}),e(".ss-gridfield-treeView--toggle").entwine({onclick:function(){return!1}}),e(".ss-gridfield-hasOneSelector-reset_button[data-relation]").entwine({onclick:function(){return this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){e(this).find("input").prop("checked",!1)}),!1}}),e(".ss-gridfield-hasOneSelector-toggle[data-relation]").entwine({onclick:function(){var i=this.prop("checked");this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){e(this).find("input").prop("checked",!i)})}}),e(".ss-gridfield.ss-gridfield-add-inline-extended--table").entwine({reload:function(e,i){var s=this,d=s.find("tbody:first").find(".ss-gridfield-inline-new-extended--row").detach(),t=arguments;this._super(e,function(){d.length&&(d.appendTo(s.find("tbody:first")),s.find("tbody:first").children(".ss-gridfield-no-items:first").hide()),i&&i.apply(s,t)})},onaddnewinlinextended:function(i,s){if(i.target==this[0]){var d=this.find("tbody:first"),t=this.data("add-inline-num")||1;if(s&&s.data("ajax")){var n=s.hasClass("ss-ui-action-constructive"),a=s.siblings(".ss-gridfield-inline-new-extended--class-selector:first"),l={_datanum:t};if(a.length){if(!a.val())return void alert("Please select a type to create");l[this.attr("id")+"_modelClass"]=a.val()}s.addClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),s.find(".ui-icon").addClass("ss-ui-loading-icon"),n&&s.removeClass("ss-ui-action-constructive"),e.ajax({url:s[0].href,dataType:"html",data:l,success:function(i){s.removeClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),s.find(".ui-icon").removeClass("ss-ui-loading-icon");var t=e(i);t.find("ss-gridfield-editable-row--toggle"),d.append(t),d.children(".ss-gridfield-no-items:first").hide(),t.find("input:first").focus(),n&&s.addClass("ss-ui-action-constructive")},error:function(e){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),s.removeClass("ss-gridfield-add-inline-extended--loading disabled")}})}else{var r=window.tmpl,o=this.find(".ss-gridfield-add-inline-extended--template:last");r.cache[this[0].id+"-ss-gridfield-add-inline-extended--template"]=r(o.html());var g=e(r(this[0].id+"-ss-gridfield-add-inline-extended--template",{num:t}));d.append(g),d.children(".ss-gridfield-no-items:first").hide(),g.find("input:first").focus()}this.data("add-inline-num",t+1)}}}),e(".ss-gridfield-add-new-inline-extended--button").entwine({onclick:function(){return this.getGridField().trigger("addnewinlinextended",[this]),!1}}),e(".ss-gridfield-inline-new-extended--row-delete").entwine({onclick:function(){var e=this.parents(".ss-gridfield:first");return confirm(ss.i18n._t("GridFieldExtensions.CONFIRMDEL","Are you sure you want to delete this?"))&&(this.parents("tbody:first").find("tr[data-inline-new-extended-row="+this.parents("tr[data-inline-new-extended-row]:first").data("inlineNewExtendedRow")+"]").remove(),e.showNoItemsMessage()),!1}}),e(".ss-gridfield-add-inline-extended--toggle").entwine({onclick:function(){var e=this.parents("tr:first");return this.toggleClass("ss-gridfield-add-inline-extended--toggle_open"),e.parent().find(".ss-gridfield-inline-new-extended--row--has-columns[data-inline-new-extended-row="+e.data("inlineNewExtendedRow")+"]").toggleClass("ss-gridfield-inline-new-extended--row--has-columns_open"),!1}}),e(".ss-gridfield.ss-gridfield-editable-rows").entwine({reload:function(e,i){var s=this,d=s.getOpenToggles(),t=arguments;this._super(e,function(){s.reopenToggles(d),i&&i.apply(s,t)})},getOpenToggles:function(){var i=this,s=[];return i.hasClass("ss-gridfield-editable-rows_disableToggleState")?s:(i.find(".ss-gridfield-editable-row--toggle_open").each(function(i){var d=e(this),t=d.parents("td:first"),n=d.parents("tr:first"),a=n.parents(".ss-gridfield:first"),l=n.next();if(l.hasClass("ss-gridfield-editable-row--row")&&l.data("id")==n.data("id")&&l.data("class")==n.data("class")){if(a.hasClass("ss-gridfield-editable-rows_disableToggleState"))return!0}else l=null;s[i]={link:t.data("link")},l&&(l.find(".ss-tabset.ui-tabs").each(function(){s[i].tabs||(s[i].tabs={}),s[i].tabs[this.id]=e(this).tabs("option","selected")}),a.hasClass("ss-gridfield-editable-rows_allowCachedToggles")&&(s[i].row=l.detach()))}),s)},reopenToggles:function(i){var s=this,d=function(i,s){i.hasOwnProperty("tabs")&&i.tabs&&e.each(i.tabs,function(e,i){s.find("#"+e+".ss-tabset.ui-tabs").tabs({active:i})})};s.hasClass("ss-gridfield-editable-rows_disableToggleState")||e.each(i,function(e){if(!i[e].hasOwnProperty("link")||!i[e].link)return!0;var t=s.find("td.ss-gridfield-editable-row--icon-holder[data-link='"+i[e].link+"']");if(!t.length)return!0;if(i[e].hasOwnProperty("row")&&i[e].row){var n=t.parents("tr:first");t.find(".ss-gridfield-editable-row--toggle").addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),n.next().hasClass("ss-gridfield-editable-row--row")||n.after(i[e].row)}else i[e].hasOwnProperty("link")&&i[e].link&&t.find(".ss-gridfield-editable-row--toggle").trigger("click",function(t){s.find(".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(i),d(i[e],t)},!1)})}}),e(".ss-gridfield-editable-row--toggle").entwine({onclick:function(i,s,d){var t=this,n=t.parents("td:first"),a=n.data("link"),l=t.parents("tr:first");if(l.hasClass("ss-gridfield-editable-row--loading"))return!1;if(a&&!t.hasClass("ss-gridfield-editable-row--toggle_loaded"))l.addClass("ss-gridfield-editable-row--loading"),e.ajax({url:a,dataType:"html",success:function(i){var n=e(i);t.addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),l.removeClass("ss-gridfield-editable-row--loading"),l.after(n),d!==!1&&n.find("input:first").focus(),"function"==typeof s&&s(n,t,l)},error:function(e){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),l.removeClass("ss-gridfield-editable-row--loading")}});else if(a){var r=l.next();r.hasClass("ss-gridfield-editable-row--row")&&r.data("id")==l.data("id")&&r.data("class")==l.data("class")&&(t.toggleClass("ss-gridfield-editable-row--toggle_open"),t.hasClass("ss-gridfield-editable-row--toggle_open")?r.removeClass("ss-gridfield-editable-row--row_hide").find("input:first").focus():r.addClass("ss-gridfield-editable-row--row_hide"))}return!1}});var i;e(".ss-gridfield-range-slider--field.rangeslider.has-rangeslider").entwine({onchange:function(e){if(e.timeStamp!=i){i=e.timeStamp;var s=this.parents(".ss-gridfield-range-slider:first"),d=s.find(".ss-gridfield-range-slider--button");d.length&&d.click()}}})})}(jQuery);