!function(e){e.entwine("ss",function(e){e(".ss-gridfield").entwine({showNoItemsMessage:function(){0===this.find(".ss-gridfield-items:first").children().not(".ss-gridfield-no-items").length&&this.find(".ss-gridfield-no-items").show()}}),e(".gridfield-help-button-dialog").entwine({loadDialog:function(e){var i=this.addClass("loading").children(".ui-dialog-content").empty();e.done(function(e){i.html(e).parent().removeClass("loading")})}}),e(".ss-gridfield .gridfield-help-button").entwine({onclick:function(){var i=e("<div></div>").appendTo("body").dialog({modal:!1,resizable:!0,width:600,height:600,close:function(){e(this).dialog("destroy").remove()}});return i.parent().addClass("gridfield-help-button-dialog").loadDialog(e.get(this.prop("href"))),i.data("grid",this.closest(".ss-gridfield")),!1}}),e(".ss-gridfield-hasOneSelector-reset_button[data-relation]").entwine({onclick:function(){return this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){e(this).find("input").prop("checked",!1)}),!1}}),e(".ss-gridfield-hasOneSelector-toggle[data-relation]").entwine({onclick:function(){var i=this.prop("checked");this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){e(this).find("input").prop("checked",!i)})}}),e(".ss-gridfield.ss-gridfield-add-inline-extended--table").entwine({reload:function(e,i){var d=this,t=d.find("tbody:first").find(".ss-gridfield-inline-new-extended--row").detach(),s=arguments;this._super(e,function(){t.length&&(t.appendTo(d.find("tbody:first")),d.find("tbody:first").children(".ss-gridfield-no-items:first").hide()),i&&i.apply(d,s)})},onaddnewinlinextended:function(i,d){if(i.target==this[0]){var t=this,s=t.find("tbody:first"),n=t.data("add-inline-num")||1;if(d&&d.data("ajax")){var a=d.hasClass("ss-ui-action-constructive"),l=d.siblings(".ss-gridfield-inline-new-extended--class-selector:first").find(":input"),r={_datanum:n};if(l.length){if(!l.val())return void alert("Please select a type to create");r[t.attr("id")+"_modelClass"]=l.val()}d.addClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").addClass("ss-ui-loading-icon"),a&&d.removeClass("ss-ui-action-constructive"),e.ajax({url:d[0].href,dataType:"html",data:r,success:function(i){d.removeClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").removeClass("ss-ui-loading-icon");var n=e(i);n.find("ss-gridfield-editable-row--toggle"),t.data("prepend")?s.prepend(n):s.append(n),s.children(".ss-gridfield-no-items:first").hide(),n.find("input:first").focus(),a&&d.addClass("ss-ui-action-constructive")},error:function(e){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),d.removeClass("ss-gridfield-add-inline-extended--loading disabled")}})}else{var o=window.tmpl,g=this.find(".ss-gridfield-add-inline-extended--template:last");o.cache[this[0].id+"-ss-gridfield-add-inline-extended--template"]=o(g.html());var f=e(o(this[0].id+"-ss-gridfield-add-inline-extended--template",{num:n}));s.append(f),s.children(".ss-gridfield-no-items:first").hide(),f.find("input:first").focus()}this.data("add-inline-num",n+1)}}}),e(".ss-gridfield-add-new-inline-extended--button").entwine({onclick:function(){return this.getGridField().trigger("addnewinlinextended",[this]),!1}}),e(".ss-gridfield-inline-new-extended--row-delete").entwine({onclick:function(){var e=this.parents(".ss-gridfield:first");return confirm(ss.i18n._t("GridFieldExtensions.CONFIRMDEL","Are you sure you want to delete this?"))&&(this.parents("tbody:first").find("tr[data-inline-new-extended-row="+this.parents("tr[data-inline-new-extended-row]:first").data("inlineNewExtendedRow")+"]").remove(),e.showNoItemsMessage()),!1}}),e(".ss-gridfield-add-inline-extended--toggle").entwine({onclick:function(){var e=this.parents("tr:first");return this.toggleClass("ss-gridfield-add-inline-extended--toggle_open"),e.parent().find(".ss-gridfield-inline-new-extended--row--has-columns[data-inline-new-extended-row="+e.data("inlineNewExtendedRow")+"]").toggleClass("ss-gridfield-inline-new-extended--row--has-columns_open"),!1}}),e(".cms-container").entwine({OpenGridFieldToggles:{},saveTabState:function(){var i=this,d=i.getOpenGridFieldToggles();i._super(),i.find(".ss-gridfield.ss-gridfield-editable-rows").each(function(){var i=e(this),t=i.getOpenToggles();t.length&&(d[i.attr("id")]=i.getOpenToggles())})},restoreTabState:function(i){var d=this,t=d.getOpenGridFieldToggles();d._super(i),e.each(t,function(e,i){d.find("#"+e+".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(i)}),d.find(".ss-gridfield-editable-row--toggle_start").click(),d.setOpenGridFieldToggles({})}}),e(".ss-gridfield.ss-gridfield-editable-rows").entwine({reload:function(e,i){var d=this,t=d.getOpenToggles(),s=arguments;this._super(e,function(){d.reopenToggles(t),d.find(".ss-gridfield-editable-row--toggle_start").click(),i&&i.apply(d,s)})},getOpenToggles:function(){var i=this,d=[];return i.hasClass("ss-gridfield-editable-rows_disableToggleState")?d:(i.find(".ss-gridfield-editable-row--toggle_open").each(function(i){var t=e(this),s=t.parents("td:first"),n=t.parents("tr:first"),a=n.parents(".ss-gridfield:first"),l=n.next();if(l.hasClass("ss-gridfield-editable-row--row")&&l.data("id")==n.data("id")&&l.data("class")==n.data("class")){if(a.hasClass("ss-gridfield-editable-rows_disableToggleState"))return!0}else l=null;d[i]={link:s.data("link")},l&&(l.find(".ss-tabset.ui-tabs").each(function(){d[i].tabs||(d[i].tabs={}),d[i].tabs[this.id]=e(this).tabs("option","selected")}),a.hasClass("ss-gridfield-editable-rows_allowCachedToggles")&&(d[i].row=l.detach()))}),d)},reopenToggles:function(i){var d=this,t=function(i,d){i.hasOwnProperty("tabs")&&i.tabs&&e.each(i.tabs,function(e,i){d.find("#"+e+".ss-tabset.ui-tabs").tabs({active:i})})};d.hasClass("ss-gridfield-editable-rows_disableToggleState")||e.each(i,function(e){if(!i[e].hasOwnProperty("link")||!i[e].link)return!0;var s=d.find("td.ss-gridfield-editable-row--icon-holder[data-link='"+i[e].link+"']");if(!s.length)return!0;if(i[e].hasOwnProperty("row")&&i[e].row){var n=s.parents("tr:first");s.find(".ss-gridfield-editable-row--toggle").addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),n.next().hasClass("ss-gridfield-editable-row--row")||n.after(i[e].row)}else i[e].hasOwnProperty("link")&&i[e].link&&s.find(".ss-gridfield-editable-row--toggle").trigger("click",function(s){d.find(".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(i),t(i[e],s)},!1)})}}),e(".ss-gridfield-editable-row--toggle").entwine({onclick:function(i,d,t){var s=this,n=s.parents("td:first"),a=n.data("link"),l=s.parents("tr:first");if(s.removeClass("ss-gridfield-editable-row--toggle_start"),l.hasClass("ss-gridfield-editable-row--loading"))return!1;if(a&&!s.hasClass("ss-gridfield-editable-row--toggle_loaded"))l.addClass("ss-gridfield-editable-row--loading"),e.ajax({url:a,dataType:"html",success:function(i){var n=e(i);s.addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),l.addClass("ss-gridfield-editable-row--reference").removeClass("ss-gridfield-editable-row--loading"),l.after(n),n.find(".ss-gridfield-editable-row--toggle_start").click(),t!==!1&&n.find("input:first").focus(),"function"==typeof d&&d(n,s,l)},error:function(e){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),l.removeClass("ss-gridfield-editable-row--loading")}});else if(a){var r=l.next();r.hasClass("ss-gridfield-editable-row--row")&&r.data("id")==l.data("id")&&r.data("class")==l.data("class")&&(s.toggleClass("ss-gridfield-editable-row--toggle_open"),s.hasClass("ss-gridfield-editable-row--toggle_open")?r.removeClass("ss-gridfield-editable-row--row_hide").find("input:first").focus():r.addClass("ss-gridfield-editable-row--row_hide"))}return!1}});var i;e(".ss-gridfield-range-slider--field.rangeslider.has-rangeslider").entwine({onchange:function(e){if(e.timeStamp!=i){i=e.timeStamp;var d=this.parents(".ss-gridfield-range-slider:first"),t=d.find(".ss-gridfield-range-slider--button");t.length&&t.click()}}}),e(".add-existing-picker-actions--add-items").entwine({onclick:function(e,i){var d=this.getDialog();this.addCloseDialogIfRequired(d),this.addItems(null,null,"",function(){i&&i(),d.data("grid").reload(),d.dialog("close")}),e.preventDefault()},getDialog:function(){return this.closest(".add-existing-search-dialog").children(".ui-dialog-content:first")},addItems:function(i,d,t,s,n){var a=this;i||(i=a.getDialog()),d||(d=i.data("items-to-add")||[]),d.length||(statusMessage(ss.i18n._t("GridField_AddExistingPicker.NO_ITEMS","No items selected"),"error"),i.find(".add-existing-search-items").children().length||i.dialog("close")),t||(t=i.find(".add-existing-picker-items").data("add-link")),s||(s=function(){i.data("grid")&&i.data("grid").reload()}),a.clearItemsToAdd(i),n||i.parent().addClass("loading loading_hiddenContents"),e.post(t,{ids:d},s).always(function(){i.parent().removeClass("loading loading_hiddenContents")})},undoItems:function(i,d,t,s,n){var a=this;d||(d=a.getDialog()),i.length&&(t||(t=d.find(".add-existing-picker-items").data("undo-link")),s||(s=function(){d.data("grid")&&d.data("grid").reload()}),n||d.parent().addClass("loading loading_hiddenContents"),e.post(t,{ids:i},function(){var e=[].slice.call(arguments);e.push(d),s.apply(this,e)}).always(function(){d.parent().removeClass("loading loading_hiddenContents")}))},clearItemsToAdd:function(e){e||(e=this.getDialog()),e.data("items-to-add",[])},addCloseDialogIfRequired:function(i){if(i||(i=this.getDialog()),!i.data("onClose")){var d=this;i.on("dialogbeforeclose",function(i,t){var s=e(this),n=s.data("items-to-add")||[];n.length&&confirm(ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.CONFIRM","Would you like to add %s selected items to the current list?"),n.length))?d.addItems(s,n,"",function(){s.data("grid").reload()}):d.clearItemsToAdd(s)}),i.data("onClose",!0)}}}),e(".add-existing-picker-item--undo-holder .add-existing-picker-item--undo").entwine({onclick:function(i){var d=this.data("id"),t=this.data("undoLink"),s=this.data("title"),n=e('.add-existing-picker-items[data-undo-link="'+t+'"]').find('.add-existing-picker-item--link[data-id="'+d+'"]');n.undoItem(d,!0,function(i,d,t,a){a.data("grid").reload(),e.noticeRemove(e(".notice-item.add-existing-picker-item--undo-holder")),statusMessage(ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.ITEM_REMOVED","%s has been removed."),s)),n.parent("li:first").show()}),i.preventDefault()}}),e(".add-existing-search-dialog .add-existing-search-items.add-existing-picker-items a").entwine({onclick:function(i){var d=this.getButton(),t=d.getDialog(),s=t.data("grid"),n=this.parent(),a=t.data("items-to-add")||[],l=this.data("id");if(s&&s.hasClass("ss-gridfield-add-existing-picker_async")){var r=t.find(".add-existing-picker-items").data("undo-link"),o=this.text();n.addClass("loading add-existing-picker-item_toAdd"),d.addItems(t,[l],"",function(i){var d=i&&i.hasOwnProperty("keep")&&i.keep;t.data("grid")&&t.data("grid").reload(),n.removeClass("add-existing-picker-item_toAdd loading"),d||n.hide(),e.noticeAdd({text:ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.ITEM_ADDED","%s has been added. %s"),o,ss.i18n.sprintf('<button type="button" class="add-existing-picker-item--undo" data-id="%s" data-undo-link="%s" data-title="%s" data-keep="%s">%s</button>',l,r,o,d?"true":"false",ss.i18n._t("UNDO","Undo"))),type:"add-existing-picker-item--undo-holder",stayTime:5e3})},!0)}else d.addCloseDialogIfRequired(t),-1===a.indexOf(l)?(a.push(l),n.addClass("add-existing-picker-item_toAdd")):(a.splice(a.indexOf(l),1),n.removeClass("add-existing-picker-item_toAdd")),t.data("items-to-add",a);i.preventDefault()},getButton:function(){return this.closest(".add-existing-search-dialog").find(".add-existing-picker-actions--add-items:first")},undoItem:function(e,i,d){e||(e=this.data("id"));var t=this.getButton();t.undoItems([e],null,"",d,i)}})})}(jQuery);