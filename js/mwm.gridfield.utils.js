!function(e){e.entwine("ss",function(e){e(".cms-container").entwine({OpenGridFieldToggles:{},saveTabState:function(){var i=this,d=i.getOpenGridFieldToggles();i._super(),i.find(".ss-gridfield.ss-gridfield-editable-rows").each(function(){var i=e(this),s=i.getOpenToggles();s.length&&(d[i.attr("id")]=i.getOpenToggles())})},restoreTabState:function(i){var d=this,s=d.getOpenGridFieldToggles();d._super(i),e.each(s,function(e,i){d.find("#"+e+".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(i)}),d.setOpenGridFieldToggles({})}}),e(".gridfield-help-button-dialog").entwine({loadDialog:function(e){var i=this.addClass("loading").children(".ui-dialog-content").empty();e.done(function(e){i.html(e).parent().removeClass("loading")})}}),e(".ss-gridfield .gridfield-help-button").entwine({onclick:function(){var i=e("<div></div>").appendTo("body").dialog({modal:!1,resizable:!0,width:600,height:600,close:function(){e(this).dialog("destroy").remove()}});return i.parent().addClass("gridfield-help-button-dialog").loadDialog(e.get(this.prop("href"))),i.data("grid",this.closest(".ss-gridfield")),!1}}),e(".ss-gridfield-treeView--toggle").entwine({onclick:function(){return!1}}),e(".ss-gridfield-hasOneSelector-reset_button[data-relation]").entwine({onclick:function(){return this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){e(this).find("input").prop("checked",!1)}),!1}}),e(".ss-gridfield-hasOneSelector-toggle[data-relation]").entwine({onclick:function(){var i=this.prop("checked");this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){e(this).find("input").prop("checked",!i)})}}),e(".ss-gridfield.ss-gridfield-add-inline-extended--table").entwine({reload:function(e,i){var d=this,s=d.find("tbody:first").find(".ss-gridfield-inline-new-extended--row").detach();this._super(e,function(){s.length&&(s.appendTo(d.find("tbody:first")),d.find("tbody:first").children(".ss-gridfield-no-items:first").hide()),i&&i.apply(d,arguments)})},onaddnewinlinextended:function(i,d){if(i.target==this[0]){var s=this.find("tbody:first"),t=this.data("add-inline-num")||1;if(d&&d.data("ajax")){var n=d.hasClass("ss-ui-action-constructive"),a=d.siblings(".ss-gridfield-inline-new-extended--class-selector:first"),l={_datanum:t};if(a.length){if(!a.val())return void alert("Please select a type to create");l[this.attr("id")+"_modelClass"]=a.val()}d.addClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").addClass("ss-ui-loading-icon"),n&&d.removeClass("ss-ui-action-constructive"),e.ajax({url:d[0].href,dataType:"html",data:l,success:function(i){d.removeClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").removeClass("ss-ui-loading-icon");var t=e(i);t.find("ss-gridfield-editable-row--toggle"),s.append(t),s.children(".ss-gridfield-no-items:first").hide(),t.find("input:first").focus(),n&&d.addClass("ss-ui-action-constructive")},error:function(e){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),d.removeClass("ss-gridfield-add-inline-extended--loading disabled")}})}else{var r=window.tmpl,o=this.find(".ss-gridfield-add-inline-extended--template:last");r.cache[this[0].id+"-ss-gridfield-add-inline-extended--template"]=r(o.html());var g=e(r(this[0].id+"-ss-gridfield-add-inline-extended--template",{num:t}));s.append(g),s.children(".ss-gridfield-no-items:first").hide(),g.find("input:first").focus()}this.data("add-inline-num",t+1)}}}),e(".ss-gridfield-add-new-inline-extended--button").entwine({onclick:function(){return this.getGridField().trigger("addnewinlinextended",[this]),!1}}),e(".ss-gridfield-inline-new-extended--row-delete").entwine({onclick:function(){return confirm(ss.i18n._t("GridFieldExtensions.CONFIRMDEL","Are you sure you want to delete this?"))&&this.parents("tbody:first").find("tr[data-inline-new-extended-row="+this.parents("tr[data-inline-new-extended-row]:first").data("inlineNewExtendedRow")+"]").remove(),!1}}),e(".ss-gridfield-add-inline-extended--toggle").entwine({onclick:function(){var e=this.parents("tr:first");return this.toggleClass("ss-gridfield-add-inline-extended--toggle_open"),e.parent().find(".ss-gridfield-inline-new-extended--row--has-columns[data-inline-new-extended-row="+e.data("inlineNewExtendedRow")+"]").toggleClass("ss-gridfield-inline-new-extended--row--has-columns_open"),!1}}),e(".ss-gridfield.ss-gridfield-editable-rows").entwine({reload:function(e,i){var d=this,s=d.getOpenToggles();this._super(e,function(){d.reopenToggles(s),i&&i.apply(d,arguments)})},getOpenToggles:function(){var i=this,d=[];return i.hasClass("ss-gridfield-editable-rows_disableToggleState")?d:(i.find(".ss-gridfield-editable-row--toggle_open").each(function(i){var s=e(this),t=s.parents("td:first"),n=s.parents("tr:first"),a=n.parents(".ss-gridfield:first"),l=n.next();if(l.hasClass("ss-gridfield-editable-row--row")&&l.data("id")==n.data("id")&&l.data("class")==n.data("class")){if(a.hasClass("ss-gridfield-editable-rows_disableToggleState"))return!0}else l=null;d[i]={link:t.data("link")},l&&(l.find(".ss-tabset.ui-tabs").each(function(){d[i].tabs||(d[i].tabs={}),d[i].tabs[this.id]=e(this).tabs("option","selected")}),a.hasClass("ss-gridfield-editable-rows_allowCachedToggles")&&(d[i].row=l.detach()))}),d)},reopenToggles:function(i){var d=this,s=function(i,d){i.hasOwnProperty("tabs")&&i.tabs&&e.each(i.tabs,function(e,i){d.find("#"+e+".ss-tabset.ui-tabs").tabs({active:i})})};d.hasClass("ss-gridfield-editable-rows_disableToggleState")||e.each(i,function(e){if(!i[e].hasOwnProperty("link")||!i[e].link)return!0;var t=d.find("td.ss-gridfield-editable-row--icon-holder[data-link='"+i[e].link+"']");if(!t.length)return!0;if(i[e].hasOwnProperty("row")&&i[e].row){var n=t.parents("tr:first");t.find(".ss-gridfield-editable-row--toggle").addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),n.next().hasClass("ss-gridfield-editable-row--row")||n.after(i[e].row)}else i[e].hasOwnProperty("link")&&i[e].link&&t.find(".ss-gridfield-editable-row--toggle").trigger("click",function(t){d.find(".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(i),s(i[e],t)},!1)})}}),e(".ss-gridfield-editable-row--toggle").entwine({onclick:function(i,d,s){var t=this,n=t.parents("td:first"),a=n.data("link"),l=t.parents("tr:first");if(l.hasClass("ss-gridfield-editable-row--loading"))return!1;if(a&&!t.hasClass("ss-gridfield-editable-row--toggle_loaded"))l.addClass("ss-gridfield-editable-row--loading"),e.ajax({url:a,dataType:"html",success:function(i){var n=e(i);t.addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),l.removeClass("ss-gridfield-editable-row--loading"),l.after(n),s!==!1&&n.find("input:first").focus(),"function"==typeof d&&d(n,t,l)},error:function(e){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),l.removeClass("ss-gridfield-editable-row--loading")}});else if(a){var r=l.next();r.hasClass("ss-gridfield-editable-row--row")&&r.data("id")==l.data("id")&&r.data("class")==l.data("class")&&(t.toggleClass("ss-gridfield-editable-row--toggle_open"),t.hasClass("ss-gridfield-editable-row--toggle_open")?r.removeClass("ss-gridfield-editable-row--row_hide").find("input:first").focus():r.addClass("ss-gridfield-editable-row--row_hide"))}return!1}});var i;e(".ss-gridfield-range-slider--field.rangeslider.has-rangeslider").entwine({onchange:function(e){if(e.timeStamp!=i){i=e.timeStamp;var d=this.parents(".ss-gridfield-range-slider:first"),s=d.find(".ss-gridfield-range-slider--button");s.length&&s.click()}}})})}(jQuery);